import{R as c,_ as d,u as P,a as I,h as l,e as o,j as s,P as E,p as D,w as S,q as k,s as z,t as T,v as F,x as L}from"./index.2a09c462.js";import{showAlert as U}from"./Alert.50347e28.js";const q=c.lazy(()=>d(()=>import("./Card.b344d4ba.js"),["assets/Card.b344d4ba.js","assets/index.2a09c462.js","assets/index.98840e68.css"])),O=c.lazy(()=>d(()=>import("./Button.971c0965.js"),["assets/Button.971c0965.js","assets/index.2a09c462.js","assets/index.98840e68.css"])),j=c.lazy(()=>d(()=>import("./Avatar.2c2dafe3.js"),["assets/Avatar.2c2dafe3.js","assets/index.2a09c462.js","assets/index.98840e68.css"])),B=c.lazy(()=>d(()=>import("./Alert.50347e28.js"),["assets/Alert.50347e28.js","assets/index.2a09c462.js","assets/index.98840e68.css"])),M=c.lazy(()=>d(()=>import("./index.2a09c462.js").then(t=>t.ab),["assets/index.2a09c462.js","assets/index.98840e68.css"])),J=({})=>{var N;const t=P(e=>e.user),p=P(e=>e.alert),f=I(),[g,h]=l.exports.useState(""),[m,y]=l.exports.useState(""),[x,w]=l.exports.useState(""),[A,b]=l.exports.useState(!1),i=l.exports.useRef(null);l.exports.useEffect(()=>{t.data&&(h(t.data.name),y(t.data.displayName))},[t]);const _=e=>{e.target.id==="name"&&h(e.target.value),e.target.id==="display-name"&&y(e.target.value)},R=e=>{var a;if(i.current!==null){const r=i.current;r.files&&(a=r.files[0])}a&&a.size>1097152&&(U("Error!","The file you are trying to upload is too big! (Maximum accepted size is 1MB)","danger",f),e.target.value="")},v=async e=>{if(t.data){const a=E(D,"users",t.data.uid),r={...t.data,...e};await S(a,{...e}),f(k(r))}},C=async()=>{t.data&&t.data.posts.forEach(async a=>{var n;const r=E(D,"posts",a);await S(r,{"author.displayName":m,"author.photoUrl":x||((n=t.data)==null?void 0:n.photoUrl)})})},V=async e=>{var n;const a=z(T,`profilepics/${(n=t.data)==null?void 0:n.uid}`),r=F(a,e);b(!0),r.on("state_changed",u=>{},u=>{console.error("File upload failed!")},()=>{L(r.snapshot.ref).then(u=>{v({photoUrl:u}),w(u),b(!1)})})};return o("form",{onSubmit:async e=>{if(e.preventDefault(),!g||!m){U("Error!","Some of the required inputs are empty. Please fill them up.","danger",f);return}var a;if(i.current!==null){const r=i.current;r.files&&(a=r.files[0])}a&&await V(a),v({name:g,displayName:m}),t.data&&t.data.posts.length>0&&C()},children:[s("h1",{className:"mx-4 mt-8 mb-4 text-center text-2xl font-bold text-gray-900",children:"Profile settings"}),o(q,{customClasses:"p-4 my-6",children:[p.data.isShown&&s(B,{title:p.data.title,variant:p.data.variant,children:p.data.text}),s("h2",{className:"mb-4 text-xl font-bold text-gray-900",children:"User"}),o("div",{className:"flex flex-col gap-2 my-2",children:[s("label",{htmlFor:"name",className:"block mb-2 text-sm font-medium text-gray-900",children:"Name: *"}),s("input",{onChange:_,value:g,id:"name",type:"text",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"})]}),o("div",{className:"flex flex-col gap-2 my-2",children:[s("label",{htmlFor:"display-name",className:"block mb-2 text-sm font-medium text-gray-900",children:"Display Name: *"}),s("input",{onChange:_,value:m,id:"display-name",type:"text",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"})]}),o("div",{className:"flex flex-col gap-2 my-2",children:[s("label",{htmlFor:"profile-pic",className:"block mb-2 text-sm font-medium text-gray-900",children:"Profile Picture:"}),o("div",{className:"flex gap-4 items-center",children:[s(j,{imgLink:(N=t.data)==null?void 0:N.photoUrl}),s("input",{onChange:R,id:"profile-pic",type:"file",accept:"image/png, image/jpeg",ref:i})]})]})," ",s("div",{className:"ml-auto w-fit",children:A?s(M,{}):s(O,{type:"submit",text:"Submit changes",variant:"primary"})})]})]})};export{J as default};
