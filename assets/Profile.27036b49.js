import{R as d,_ as c,u as b,a as A,h as u,e as R,j as r,P as v,p as x,w as E,q as V,s as w,t as I,v as z,x as T}from"./index.fcf2c776.js";import{showAlert as P}from"./Alert.0b6d2226.js";const F=d.lazy(()=>c(()=>import("./Button.b4db02de.js"),["assets/Button.b4db02de.js","assets/index.fcf2c776.js","assets/index.644a72a2.css"])),q=d.lazy(()=>c(()=>import("./Alert.0b6d2226.js"),["assets/Alert.0b6d2226.js","assets/index.fcf2c776.js","assets/index.644a72a2.css"])),L=d.lazy(()=>c(()=>import("./index.fcf2c776.js").then(a=>a.ab),["assets/index.fcf2c776.js","assets/index.644a72a2.css"])),O=d.lazy(()=>c(()=>import("./UserForm.ca0809cd.js"),["assets/UserForm.ca0809cd.js","assets/index.fcf2c776.js","assets/index.644a72a2.css"])),C=d.lazy(()=>c(()=>import("./AboutForm.8c4c8240.js"),["assets/AboutForm.8c4c8240.js","assets/index.fcf2c776.js","assets/index.644a72a2.css"])),$=({})=>{const a=b(t=>t.user),p=b(t=>t.alert),m=A(),[e,i]=u.exports.useState({name:"",displayName:"",education:"",job:""}),[h,j]=u.exports.useState(""),[D,_]=u.exports.useState(!1),n=u.exports.useRef(null);u.exports.useEffect(()=>{i(t=>a.data?{name:a.data.name,displayName:a.data.displayName,education:a.data.education,job:a.data.job}:{...t})},[a]);const g=t=>{t.target.id==="name"&&i({...e,name:t.target.value}),t.target.id==="display-name"&&i({...e,displayName:t.target.value}),t.target.id==="education"&&i({...e,education:t.target.value}),t.target.id==="job"&&i({...e,job:t.target.value})},N=t=>{var s;if(n.current!==null){const o=n.current;o.files&&(s=o.files[0])}s&&s.size>1097152&&(P("Error!","The file you are trying to upload is too big! (Maximum accepted size is 1MB)","danger",m),t.target.value="")},y=async t=>{if(a.data){const s=v(x,"users",a.data.uid),o={...a.data,...t};await E(s,{...t}),m(V(o))}},S=async()=>{a.data&&a.data.posts.forEach(async s=>{var l;const o=v(x,"posts",s);await E(o,{"author.displayName":e.displayName,"author.education":e.education,"author.job":e.job,"author.photoUrl":h||((l=a.data)==null?void 0:l.photoUrl)})})},U=async t=>{var l;const s=w(I,`profilepics/${(l=a.data)==null?void 0:l.uid}`),o=z(s,t);_(!0),o.on("state_changed",f=>{},f=>{console.error("File upload failed!")},()=>{T(o.snapshot.ref).then(f=>{y({photoUrl:f}),j(f),_(!1)})})};return R("form",{onSubmit:async t=>{if(t.preventDefault(),!e.name||!e.displayName){P("Error!","Some of the required inputs are empty. Please fill them up.","danger",m);return}var s;if(n.current!==null){const o=n.current;o.files&&(s=o.files[0])}s&&await U(s),y({...e}),a.data&&a.data.posts.length>0&&S()},children:[r("h1",{className:"mx-4 mt-8 mb-4 text-center text-2xl font-bold text-gray-900",children:"Profile settings"}),p.data.isShown&&r(q,{title:p.data.title,variant:p.data.variant,children:p.data.text}),r(O,{handleFileChange:N,handleInputChange:g,nameValue:e.name,displayNameValue:e.displayName,user:a,fileInput:n}),r(C,{handleInputChange:g,educationValue:e.education,jobValue:e.job}),r("div",{className:"ml-auto w-fit",children:D?r(L,{}):r(F,{type:"submit",text:"Submit changes",variant:"primary"})})]})};export{$ as default};
